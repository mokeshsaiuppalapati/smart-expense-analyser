<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.chart.BarChart?>
<?import javafx.scene.chart.CategoryAxis?>
<?import javafx.scene.chart.NumberAxis?>
<?import javafx.scene.chart.PieChart?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ProgressIndicator?>
<?import javafx.scene.control.Tab?>
<?import javafx.scene.control.TabPane?>
<?import javafx.scene.control.TableColumn?>
<?import javafx.scene.control.TableView?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.VBox?>
<?import org.kordamp.ikonli.javafx.FontIcon?>

<BorderPane xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.expense.ui.MainController">
    <padding>
        <Insets bottom="10.0" left="10.0" right="10.0" top="10.0" />
    </padding>
    <top>
        <VBox>
            <HBox alignment="CENTER_LEFT" spacing="8.0" style="-fx-padding: 0 0 10 0;">
                <Label styleClass="h1" text="Smart Expense Analyzer" />
                <Region HBox.hgrow="ALWAYS" />
                <Button onAction="#onImport" styleClass="top-bar-button" text="Import">
                    <graphic><FontIcon iconLiteral="mdi2d-database-import-outline" styleClass="glyph-icon" /></graphic>
                </Button>
                <Button onAction="#onExport" styleClass="top-bar-button" text="Export">
                    <graphic><FontIcon iconLiteral="mdi2d-database-export-outline" styleClass="glyph-icon" /></graphic>
                </Button>
                <Button onAction="#onOpenRecurring" styleClass="top-bar-button" text="Subscriptions">
                    <graphic><FontIcon iconLiteral="mdi2r-reload" styleClass="glyph-icon" /></graphic>
                </Button>
                <Button onAction="#onOpenBudgets" styleClass="top-bar-button" text="Budgets">
                    <graphic><FontIcon iconLiteral="mdi2p-piggy-bank-outline" styleClass="glyph-icon" /></graphic>
                </Button>
                <Button fx:id="btnRetrain" onAction="#onRetrainModel" styleClass="top-bar-button" text="Retrain AI">
                    <graphic><FontIcon iconLiteral="mdi2r-robot-outline" styleClass="glyph-icon" /></graphic>
                </Button>
                <ProgressIndicator fx:id="prog" prefHeight="25.0" prefWidth="25.0" visible="false" />
            </HBox>
        </VBox>
    </top>
    <center>
        <TabPane fx:id="mainTabPane" tabClosingPolicy="UNAVAILABLE" BorderPane.alignment="CENTER">
            <tabs>
                <Tab text="Dashboard">
                    <content>
                        <fx:include fx:id="dashboard" source="dashboard.fxml" />
                    </content>
                </Tab>
                <Tab text="Transactions">
                    <content>
                        <VBox spacing="10.0">
                            <padding><Insets top="10.0" right="10.0" bottom="10.0" left="10.0" /></padding>
                            <HBox alignment="CENTER_RIGHT" spacing="10.0">
                                <Button onAction="#onDeleteTransaction" text="Delete Selected" />
                                <Button onAction="#onAddExpense" text="Add New Expense..." styleClass="button"/>
                            </HBox>
                            <TableView fx:id="table" editable="true" VBox.vgrow="ALWAYS">
                                <columns>
                                    <TableColumn fx:id="colDate" prefWidth="120.0" text="Date" />
                                    <TableColumn fx:id="colAmount" prefWidth="100.0" text="Amount (â‚¹)" />
                                    <TableColumn fx:id="colDesc" prefWidth="300.0" text="Description" />
                                    <TableColumn fx:id="colCat" prefWidth="180.0" text="Category" />
                                </columns>
                                <columnResizePolicy><TableView fx:constant="CONSTRAINED_RESIZE_POLICY" /></columnResizePolicy>
                            </TableView>
                        </VBox>
                    </content>
                </Tab>
                <Tab text="Analysis">
                    <content>
                        <VBox spacing="10.0">
                            <padding><Insets top="10.0" right="10.0" bottom="10.0" left="10.0" /></padding>
                            <HBox alignment="CENTER_LEFT" spacing="8.0">
                                <Label text="Filter by:" />
                                <ComboBox fx:id="pieYearCombo" onAction="#onPieChartFilterChanged" prefWidth="100.0" />
                                <ComboBox fx:id="pieMonthCombo" onAction="#onPieChartFilterChanged" prefWidth="120.0" />
                            </HBox>
                            <PieChart fx:id="pieChart" VBox.vgrow="ALWAYS" />
                        </VBox>
                    </content>
                </Tab>
                <Tab fx:id="trendsTab" text="Trends">
                    <content>
                        <VBox spacing="10.0">
                            <padding><Insets top="10.0" right="10.0" bottom="10.0" left="10.0" /></padding>
                            <HBox spacing="8.0">
                                <Label text="Year:" />
                                <ComboBox fx:id="barYearCombo" onAction="#onBarYearSelected" prefWidth="120.0" />
                            </HBox>
                            <BarChart fx:id="barChart" VBox.vgrow="ALWAYS">
                                <xAxis><CategoryAxis side="BOTTOM" /></xAxis>
                                <yAxis><NumberAxis fx:id="yAxis" side="LEFT" /></yAxis>
                            </BarChart>
                        </VBox>
                    </content>
                </Tab>
                <Tab text="AI Predictions">
                    <content>
                        <VBox spacing="10.0">
                            <padding><Insets top="10.0" right="10.0" bottom="10.0" left="10.0" /></padding>
                            <Label text="Predict Future Expenses &amp; Get Budget Insights" style="-fx-font-weight: bold;"/>
                            <Button onAction="#onPredictExpenses" prefHeight="35.0" text="Generate Next Month's Forecast" styleClass="button"/>
                            <TextArea fx:id="predictionResultsArea" editable="false" prefHeight="300.0" wrapText="true" VBox.vgrow="ALWAYS" />
                        </VBox>
                    </content>
                </Tab>
            </tabs>
        </TabPane>
    </center>
</BorderPane>